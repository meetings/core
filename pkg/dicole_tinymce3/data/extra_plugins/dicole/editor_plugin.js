(function(){tinymce.PluginManager.requireLangPack("dicole");tinymce.create("tinymce.plugins.DicolePlugin",{init:function(a,b){a.addCommand("mceDicoleSaveOpen",function(){dicole_tinymce_toolbar_switch(this,"save")});a.addShortcut("ctrl+shift+s","Save","mceDicoleSaveOpen");a.addShortcut("cmd+shift+s","Save","mceDicoleSaveOpen");a.addCommand("mceDicoleCancelOpen",function(){dicole_tinymce_toolbar_switch(this,"cancel")});a.addShortcut("ctrl+w","Cancel","mceDicoleCancelOpen");a.addShortcut("cmd+w","Cancel","mceDicoleCancelOpen");a.addCommand("mceDicoleAttachmentOpen",function(){dicole_tinymce_toolbar_switch(this,"attachment")});a.addShortcut("ctrl+f","Attachment","mceDicoleAttachmentOpen");a.addShortcut("cmd+f","Attachment","mceDicoleAttachmentOpen");a.addCommand("mceDicoleLinkOpen",function(){dicole_tinymce_execute_link_open(this)});a.addShortcut("ctrl+l","Link","mceDicoleLinkOpen");a.addShortcut("cmd+l","Link","mceDicoleLinkOpen");a.addCommand("mceDicoleAdvancedOpen",function(){dicole_tinymce_toolbar_switch(this,"advanced")});a.addCommand("mceDicoleTableOpen",function(){dicole_tinymce_toolbar_switch(this,"table")});a.addCommand("mceDicoleEmbedOpen",function(){dicole_tinymce_toolbar_switch(this,"embed")});a.addCommand("mceDicoleHtmlOpen",function(){dicole_tinymce_execute_html_open(this)});a.addCommand("mceDicoleShowroomOpen",function(){dicole_tinymce_execute_showroom_open(this)});a.addCommand("mceDicoleImageOpen",function(){dicole_tinymce_execute_image_open(this)});a.addCommand("mceDicoleImageLeft",function(){dicole_tinymce_execute_image_align(this,"left")});a.addCommand("mceDicoleImageCenter",function(){dicole_tinymce_execute_image_align(this,"")});a.addCommand("mceDicoleImageRight",function(){dicole_tinymce_execute_image_align(this,"right")});a.addCommand("mceDicoleJustifyLeft",function(){dicole_tinymce_execute_justify(this,"left")});a.addCommand("mceDicoleJustifyCenter",function(){dicole_tinymce_execute_justify(this,"center")});a.addCommand("mceDicoleAnnotationRemove",function(){dicole_tinymce_annotation_remove(this)});a.addShortcut("ctrl+b","Bold","Bold");a.addShortcut("cmd+b","Bold","Bold");a.addShortcut("ctrl+i","Italic","Italic");a.addShortcut("cmd+i","Italic","Italic");a.addShortcut("ctrl+s","Strikethrough","Strikethrough");a.addShortcut("cmd+s","Strikethrough","Strikethrough");a.addShortcut("ctrl+0","Paragraph",function(){a.execCommand("Formatblock",false,"P")});a.addShortcut("cmd+0","Paragraph",function(){a.execCommand("Formatblock",false,"P")});a.addShortcut("ctrl+p","Paragraph",function(){a.execCommand("Formatblock",false,"P")});a.addShortcut("cmd+p","Paragraph",function(){a.execCommand("Formatblock",false,"P")});a.addShortcut("ctrl+1","Header 1",function(){a.execCommand("Formatblock",false,"H1")});a.addShortcut("cmd+1","Header 1",function(){a.execCommand("Formatblock",false,"H1")});a.addShortcut("ctrl+2","Header 2",function(){a.execCommand("Formatblock",false,"H2")});a.addShortcut("cmd+2","Header 2",function(){a.execCommand("Formatblock",false,"H2")});a.addShortcut("ctrl+3","Header 3",function(){a.execCommand("Formatblock",false,"H3")});a.addShortcut("cmd+3","Header 3",function(){a.execCommand("Formatblock",false,"H3")});a.addShortcut("ctrl+4","Header 4",function(){a.execCommand("Formatblock",false,"H4")});a.addShortcut("cmd+4","Header 4",function(){a.execCommand("Formatblock",false,"H4")});a.addShortcut("ctrl+5","Header 5",function(){a.execCommand("Formatblock",false,"H5")});a.addShortcut("cmd+5","Header 5",function(){a.execCommand("Formatblock",false,"H5")});a.addShortcut("ctrl+6","Header 6",function(){a.execCommand("Formatblock",false,"H6")});a.addShortcut("cmd+6","Header 6",function(){a.execCommand("Formatblock",false,"H6")});a.addButton("dicole_save_open",{title:"dicole.button_save_open",cmd:"mceDicoleSaveOpen","class":"dicole_save"});a.addButton("dicole_cancel_open",{title:"dicole.button_cancel_open",cmd:"mceDicoleCancelOpen","class":"dicole_cancel"});a.addButton("dicole_attachment_open",{title:"dicole.button_attachment_open",cmd:"mceDicoleAttachmentOpen","class":"dicole_attachment"});a.addButton("dicole_link_open",{title:"dicole.button_link_open",cmd:"mceDicoleLinkOpen","class":"dicole_link"});a.addButton("dicole_advanced_open",{title:"dicole.button_advanced_open",cmd:"mceDicoleAdvancedOpen","class":"dicole_advanced"});a.addButton("dicole_table_open",{title:"dicole.button_table_open",cmd:"mceDicoleTableOpen","class":"dicole_table"});a.addButton("dicole_embed_open",{title:"dicole.button_embed_open",cmd:"mceDicoleEmbedOpen","class":"dicole_embed"});a.addButton("dicole_html_open",{title:"dicole.button_html_open",cmd:"mceDicoleHtmlOpen","class":"dicole_html"});a.addButton("dicole_showroom_open",{title:"dicole.button_showroom_open",cmd:"mceDicoleShowroomOpen","class":"dicole_showroom"});a.addButton("dicole_image_open",{title:"dicole.button_image_open",cmd:"mceDicoleImageOpen","class":"dicole_image"});a.addButton("dicole_image_left",{title:"dicole.button_image_left",cmd:"mceDicoleImageLeft","class":"dicole_image_left"});a.addButton("dicole_image_center",{title:"dicole.button_image_center",cmd:"mceDicoleImageCenter","class":"dicole_image_center"});a.addButton("dicole_image_right",{title:"dicole.button_image_right",cmd:"mceDicoleImageRight","class":"dicole_image_right"});a.addButton("dicole_justify_left",{title:"dicole.button_justify_left",cmd:"mceDicoleJustifyLeft","class":"dicole_justify_left"});a.addButton("dicole_justify_center",{title:"dicole.button_justify_center",cmd:"mceDicoleJustifyCenter","class":"dicole_justify_center"});a.addButton("dicole_annotation_remove",{title:"dicole.button_annotation_remove",cmd:"mceDicoleAnnotationRemove","class":"dicole_image"});a.onKeyUp.add(function(d,e){if(e.keyCode==dojo.keys.ENTER){var c=d.dom.getParent(d.selection.getNode(),"span.wiki_anno.wiki_anno_begin.wiki_anno_end");if(c){d.selection.select(c);d.selection.setContent(c.innerHTML)}}});a.onPostProcess.add(function(f,j){var e=f.dom.getParent(f.selection.getNode(),"span.wiki_anno.wiki_anno_begin.wiki_anno_end");if(e){var d=["a","abbr","acronym","b","basefont","bdo","big","br","cite","code","dfn","em","font","i","img","input","kbd","label","q","s","samp","select","small","span","strike","strong","sub","sup","textarea","tt","u","var"];var i=new RegExp("<(?!/)(?!"+d.join("|")+")[^>]*>","im");var c=j.content.search(i);if(c!=-1){var h=j.content.substr(0,c);var g=j.content.substr(c);f.selection.setContent(h)}else{f.selection.setContent(j.content)}j.content=""}});a.onNodeChange.add(function(g,k,c,j){k.setDisabled("dicole_link_open",true);k.setDisabled("dicole_showroom_open",true);k.setDisabled("dicole_html_open",false);k.setDisabled("dicole_image_open",false);k.setDisabled("dicole_justify_left",true);k.setDisabled("dicole_justify_center",true);k.setActive("dicole_justify_left",false);k.setActive("dicole_justify_center",false);k.setActive("dicole_image_left",false);k.setActive("dicole_image_center",false);k.setActive("dicole_image_right",false);dicole_tinymce_toolbar_set_imagecontrols_visibility(g,false);var d=g.dom.getParent(c,"A");if(d){if(g.dom.hasClass(d,"dicole_showroom_link")){k.setDisabled("dicole_showroom_open",false)}else{k.setDisabled("dicole_link_open",false)}k.setDisabled("dicole_html_open",true)}else{if(!j){k.setDisabled("dicole_link_open",false);k.setDisabled("dicole_showroom_open",false);k.setDisabled("dicole_html_open",true)}}var i=g.dom.getParent(c,"IMG");if(i){if(c.className.indexOf("mceItem")!=-1){k.setDisabled("dicole_html_open",true)}else{if(g.dom.hasClass(i,"dicole_embedded_html")){k.setDisabled("dicole_html_open",false)}else{dicole_tinymce_toolbar_set_imagecontrols_visibility(g,true);var h=g.dom.getAttrib(c,"align");k.setActive("dicole_image_left",h=="left");k.setActive("dicole_image_center",h=="");k.setActive("dicole_image_right",h=="right");k.setDisabled("dicole_html_open",true)}}}var f=g.dom.getParent(c,"P");if(f){k.setDisabled("dicole_justify_left",false);k.setDisabled("dicole_justify_center",false);if(dojo.style(f,"textAlign")!="center"&&dojo.style(f,"textAlign")!="left"){dojo.style(f,"textAlign","left")}if(dojo.style(f,"textAlign")=="center"){k.setActive("dicole_justify_center",true)}else{if(dojo.style(f,"textAlign")=="left"){k.setActive("dicole_justify_left",true)}}}var e=g.dom.getParents("p.dicole_embedded_html_container",c);if(g.dom.is(c,"p.dicole_embedded_html_container")){e.push(c)}dojo.forEach(e,function(l){if(!g.dom.select("img.dicole_embedded_html",l).length){g.dom.removeClass(l,"dicole_embedded_html_container")}});if(g.dom.getParent(c,"span.wiki_anno.wiki_anno_begin.wiki_anno_end")){k.setDisabled("dicole_annotation_remove",false)}else{k.setDisabled("dicole_annotation_remove",true)}if(!tinyMCE.activeEditor.getParam("dicole_disable_resize")){_resize_editor()}})},createControl:function(b,a){switch(b){case"dicole_attachment_container":case"dicole_link_container":case"dicole_embed_container":case"dicole_html_container":case"dicole_showroom_container":case"dicole_image_container":case"dicole_save_container":case"dicole_cancel_container":return tinyMCE.activeEditor.plugins.dicole.myTemplateControl(b,a);case"dicole_save_open":return tinyMCE.activeEditor.plugins.dicole.myTextButtonControl(b,a,{title:"dicole.button_save_open",cmd:"mceDicoleSaveOpen",text:tinyMCE.activeEditor.translate("dicole.button_save_text"),"class":"dicole_save"});case"dicole_cancel_open":return tinyMCE.activeEditor.plugins.dicole.myTextButtonControl(b,a,{title:"dicole.button_cancel_open",cmd:"mceDicoleCancelOpen",text:tinyMCE.activeEditor.translate("dicole.button_cancel_text"),"class":"dicole_cancel"})}return null},myOpen:function(a,b,c){a.windowManager.open({file:b,width:650,height:520,inline:1},c)},myTemplateControl:function(e,a){var b=tinyMCE.activeEditor.id+"";var d=new tinymce.ui.Control(e);d.renderHTML=function(){var c=tinymce3_data[e+"_template"]||"";c=c.replace(/REPLACE:EDITOR:ID:HERE/g,b);return c};d.postRender=function(){dicole_tinymce_container_postrender(e,a,b)};return d},myTextButtonControl:function(f,a,d){var b=tinyMCE.activeEditor;d.title=b.translate(d.title);d.label=b.translate(d.label);d.scope=d.scope||b;d=tinymce.extend({title:d.title,unavailable_prefix:b.getLang("unavailable",""),scope:d.scope,control_manager:a,onclick:function(){b.execCommand(d.cmd,d.ui||false,d.value)}},d);var e=new tinymce.ui.Button(f,d);e.renderHTML=function(){var k=this.classPrefix,j=this.settings,i,c,g;c=tinymce.DOM.encode(j.label||"");g=tinymce.DOM.encode(j.text||"");i='<a id="'+this.id+'" href="javascript:;" class="dicole_tinymce3_submit_small_outer '+k+" "+k+"Enabled "+j["class"]+(c?" "+k+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" title="'+tinymce.DOM.encode(j.title)+'">';i+='<span class="dicole_tinymce3_submit_small_inner '+j["class"]+'">'+g+"</span>"+(c?'<span class="'+k+'Label">'+c+"</span>":"")+"</a>";return i};return e},getInfo:function(){return{longname:"Dicole plugin",author:"Antti Vähäkotamäki",authorurl:"http://dicole.com/",infourl:"",version:"1.0"}}});tinymce.PluginManager.add("dicole",tinymce.plugins.DicolePlugin)})();